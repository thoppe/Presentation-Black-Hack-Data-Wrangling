<!doctype html>
<html lang="en">

  <head>
    <meta charset="utf-8">

    <title>Black Hat Data Wrangling</title>
    
    <meta name="description" content="">
    <meta name="author" content="Travis Hoppe & Robert Dempsey">

    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" 
	  content="black-translucent" />

    <meta name="viewport" content="width=device-width, 
				   initial-scale=1.0, 
				   maximum-scale=1.0, 
				   user-scalable=no">

    <link rel="stylesheet" href="reveal.js/css/reveal.css">

    <!-- Default themes -->
    <link rel="stylesheet" href="reveal.js/css/theme/simple.css" id="theme">
    <link rel="stylesheet" href="reveal.js/css/theme/night.css" id="theme">

    <!-- For syntax highlighting -->
    <link rel="stylesheet" href="reveal.js/lib/css/zenburn.css">

    <!-- For LaTeX formating highlighting -->
    <link rel="stylesheet" href="md2reveal/css/md2reveal_style.css">

    <!--[if lt IE 9]>
	<script src="reveal.js/lib/js/html5shiv.js"></script>
	<![endif]-->
  </head>

  <body>

    <div class="reveal"><div class="slides">
	<section class="vertical-stack">
<section   class="vertical-slide">
<p>
</p>
<br>
<p>
<h1>Black Hat</h1><h1>Data Wrangling</h1></p>
<hr>
<p>
<h3><a href="http://thoppe.github.io/">Travis Hoppe</a> / <a href="http://robertwdempsey.com/about-robert-dempsey/">Robert Dempsey</a></h3><a href="https://twitter.com/metasemantic">@metasemantic</a> / <a href="https://twitter.com/rdempsey">@rdempsey</a></p>
<br>
<p>
<div class="reference_footnote"><a href="http://thoppe.github.io/Presentation-Black-Hack-Data-Wrangling">http://thoppe.github.io/Presentation-Black-Hack-Data-Wrangling</a></div><br><style>.whitehat {background:#333333;padding-bottom:0px !important;}</style></p>
</section>
</section><section class="vertical-stack">
<section   class="vertical-slide">
<p>
<h1>Data Wranglers</h1><h2>Want your data!</h2></p>
<br>
<figure>
    <a href="images/data_ST.gif">
    <img class="" src="images/data_ST.gif" height="300px">
    </a>
    
    </figure>
<figure>
    <a href="images/fast_type.gif">
    <img class="" src="images/fast_type.gif" height="300px">
    </a>
    
    </figure>
<br>
<p>
<h2>How can you <strong><strike>stop</strike></strong> slow them?</h2></p>
</section><section   class="vertical-slide">
<p>
<h2>White-hat data wrangler</h2>Working hard to make your data <strong>accessible</strong> to others.</p>
<figure>
    <a href="images/dcdw_logo.jpg">
    <img class="transparent_image" src="images/dcdw_logo.jpg" height="200px">
    </a>
    
    </figure>
<figure>
    <a href="images/DSDC_logo.png">
    <img class="transparent_image" src="images/DSDC_logo.png" height="200px">
    </a>
    
    </figure>
<figure>
    <a href="images/nyc_dw_logo.png">
    <img class="transparent_image" src="images/nyc_dw_logo.png" height="200px">
    </a>
    
    </figure>
<br>
<br>
<br>
<br>
<p>
<em>But what if you don't want people to have your data...?</em></p>
</section><section   class="vertical-slide">
<p>
<h2>Black-hat data wrangler</h2>Working hard to make your data as <strong>inaccessible</strong> as possible.</p>
<br>
<figure>
    <a href="images/evil_mrburns.png">
    <img class="transparent_image" src="images/evil_mrburns.png" height="200px">
    </a>
    
    </figure>
<figure>
    <a href="images/evil_cards.jpg">
    <img class="transparent_image" src="images/evil_cards.jpg" height="200px">
    </a>
    
    </figure>
<figure>
    <a href="images/evil_umbrella2.png">
    <img class="transparent_image" src="images/evil_umbrella2.png" height="200px">
    </a>
    
    </figure>
<br>
<br>
<p>
What kind of data?</p>
<br>
<p>
<em>Corporate finance / Political Dontations / Regulations /</em><br><em> Anti-FOIA / Digital Marketer / ...</em></p>
</section><section   class="vertical-slide">
<p>
<h2>Why not disconnect from the net?</h2></p>
<br>
<br>
<figure>
    <a href="images/drevil2.jpg">
    <img class="" src="images/drevil2.jpg" height="300px">
    </a>
    
    </figure>
<figure>
    <a href="images/drevil.jpg">
    <img class="" src="images/drevil.jpg" height="300px">
    </a>
    
    </figure>
<figure>
    <a href="images/drevil3.jpg">
    <img class="" src="images/drevil3.jpg" height="300px">
    </a>
    
    </figure>
</section><section   class="vertical-slide">
<p>
<h1>When do you need a</h1><h2><em>Black Hack Data Wrangler?</em></h2></p>
<br>
<p>
<h3>You have a <strong>large</strong> amount of data</h3><h3>The data must be made <strong>public</strong></h3><h3>Should be human readable but <strong>computer-unfriendly</strong></h3><h3>Your actions should be <strong>hidden</strong> to a casual user</h3></p>
</section>
</section><section class="vertical-stack">
<section   class="vertical-slide">
<p>
slide explaining the levels...</p>
</section>
</section><section class="vertical-stack">
<section   class="vertical-slide">
<p>
<h3>Table of Contents</h3></p>
<br>
<p>
<h4><a href="#Hack1">Disable right-click</a> [T, drafted]</h4><h4><a href="#Hack2">Minification</a> [R, drafted]</h4><h4><a href="#Hack3">Authentication</a> [T, drafted]</h4><h4><a href="#Hack4">Data Limits</a> [R, drafted]</h4><h4><a href="#Hack5">Rendering to Images</a> [R, drafted]</h4><h4><a href="#Hack6">JavaScript page links</a> [T, drafted]</h4><h4><a href="#Hack7">Watermarking</a> [R, partially drafted]</h4><h4><a href="#Hack8">Honeypots & Stenography</a> [T, drafted]</h4><h4><a href="#Hack9">Remove markup metadata</a> [T, drafted]</h4><h4><a href="#Hack10">HTML obfuscation</a> [R]</h4><h4><a href="#Hack11">Serving as PDF</a> [R]</h4><h4><a href="#Hack12">Font remapping</a> [T]</h4></p>
</section>
</section><section class="vertical-stack">
<section id="Hack1"  class="vertical-slide">
<p>
<h2><code>BlackHat1</code>: Disable right-click</h2>implementation <strong>EASY</strong> : defense <strong>TRIVIAL</strong> : hack-level <strong>AMATEUR</strong></p>
<br>
<pre><code class=python>&lt;script language=&quot;javascript&quot;&gt;
document.onmousedown=disableclick;
status=&quot;Right Click Disabled&quot;;
function disableclick(event) {
  if(event.button==2) {
     alert(status);
     return false;    
} }
&lt;/script&gt;</code></pre>
</section><section   class="vertical-slide">
<p>
<div class="whitehat"><h2><code>WhiteHat1</code>: Disable right-click</h2></p>
<br>
<p>
<h3>Open developers console (F12), search for <code>disableclick</code> and remove.</h3></p>
<br>
<p>
<h3>Turn of javascript.</h3></p>
<br>
<p>
<h3>Use a headless (or mobile) browser.</h3></div></p>
</section>
</section><section class="vertical-stack">
<section id="Hack2"  class="vertical-slide">
<p>
<h2><code>BlackHat2</code>: Minification</h2>implementation <strong>EASY</strong> : defense <strong>TRIVIAL</strong> : hack-level <strong>AMATEUR</strong></p>
<br>
<p>
<a href="https://github.com/kangax/html-minifier">Kangax HTML Minifier</a>: removes comments, whitespace, empty elements, and much more. Also minifies javascript and CSS.</p>
<br>
<p>
Ruby wrapper: <a href="https://github.com/stereobooster/html_minifier">html_minifier</a></p>
</section><section   class="vertical-slide">
<p>
<h2><code>WhiteHat2</code>: Minification</h2>De-minify the HTML using freely available tools.</p>
<br>
<p>
Online tools: <a href="http://unminify.com/">Unminify</a>, <a href="">JS Beautifier</a><br><em>or</em><br>Text editor: <a href="https://github.com/welovewordpress/SublimeHtmlTidy">HTML Tidy</a> (Sublime Text)<br><em>or</em><br>Automate it: <a href="https://github.com/beautify-web/js-beautify">JS Beautifier</a></p>
<pre><code class=python>$ pip install jsbeautifier
$ js-beautify file.js</code></pre>
</section>
</section><section class="vertical-stack">
<section id="Hack3"  class="vertical-slide">
<p>
<h2><code>BlackHat3</code>: Authentication</h2>implementation <strong>EASY</strong> : defense <strong>MEDIUM</strong> : hack-level <strong>NEW HIRE</strong></p>
<br>
<p>
<h4>not RESTful?</h4>Implement vistor control via <code>$SESSONS</code>. Give every new visitor to the site a unique ID that you control and limit access with. Bonus, restrict user-agent.</p>
<br>
<p>
<h4>REST API?</h4>Require all meaningful data requests to go through OAuth2, cumbersome for new-comers and direct control over the data distribution.</p>
</section><section   class="vertical-slide">
<p>
<h2><code>WhiteHat3</code>: Authentication</h2></p>
<br>
<p>
Create session ID's with headless browsers<br><em>and</em><br>simulate user-agents</p>
<br>
<p>
Poorly designed session states (that don't clear and hold<br>large internal variables) can DoS your server!</p>
</section>
</section><section class="vertical-stack">
<section id="Hack4"  class="vertical-slide">
<p>
<h2><code>BlackHat4:</code> Data & time limits</h2>implementation <strong>MEDIUM</strong> : defense <strong>MEDIUM</strong> : hack-level <strong>ENTRY-LEVEL</strong></p>
<br>
<p>
Detection: high download rates or unusual traffic within a given timespan;<br>all traffic from a single client or IP address.</p>
<br>
<p>
Rate limit individual IP addresses or a specific id.<br>Delay content delivery.<br>Return HTTP 301, 40x or 50x errors (<a href="http://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html">full list</a>)</p>
</section><section   class="vertical-slide">
<p>
<h2><code>WhiteHat4</code>: Data & time limits</h2></p>
<br>
<p>
Frequently change your IP address using <a href="http://robertwdempsey.com/hma">VPN/proxy services</a> or <a href="https://www.torproject.org/">TOR</a>.<br><em>and</em><br>Slow down your scraper: Scrapy <a href="http://doc.scrapy.org/en/latest/topics/autothrottle.html">autothrottle</a>, custom timing code<br><em>and</em><br>Change your user agent: Scrapy <a href="https://github.com/cnu/scrapy-random-useragent">random user agent</a>, <a href="http://stackoverflow.com/questions/24226781/changing-user-agent-in-python-3-for-urrlib-urlopen">custom Python code</a></p>
</section>
</section><section class="vertical-stack">
<section id="Hack5"  class="vertical-slide">
<p>
<h2><code>BlackHat5</code>: Rendering to images</h2>implementation <strong>NON TRIVAL</strong> : defense <strong>PRETTY GOOD</strong> : hack-level <strong>JUNIOR-LEVEL</strong></p>
<br>
<p>
<h3>Text to Image</h3><a href="https://www.daftlogic.com/projects-text-to-image.htm">PHP Text to Image</a> / <a href="http://www.imagemagick.org/script/index.php">ImageMagick</a><br><em>or</em><br>Draw text onto an HTML5 canvas using <a href="http://jsfiddle.net/JUWrV/">JavaScript</a> / use the HTML5 <a href="http://stackoverflow.com/questions/27552969/convert-text-to-canvas-image-preserving-formatting">canvasElement.toDataURL</a> element</p>
</section><section   class="vertical-slide">
<p>
<h2><code>WhiteHat5</code>: Rending to images</h2></p>
<br>
<p>
Server or desktop-based OCR software<br><em>or</em><br>Adobe Acrobat: Image -> PDF -> OCR (manual)<br><em>or</em><br>Python: <a href="https://github.com/tmbdev/ocropy">OCRopus</a><br><em>or</em><br><a href="https://github.com/tesseract-ocr/tesseract">Tesseract Open Source OCR Engine</a></p>
</section>
</section><section class="vertical-stack">
<section id="Hack6"  class="vertical-slide">
<p>
<h2><code>BlackHat6</code>: JavaScript page links</h2>implementation <strong>STANDARD</strong> : defense <strong>MEDIUM</strong> : hack-level <strong>JUNIOR-LEVEL</strong><br>Infinite pagnation/scroll. Ex. <a href="https://dribbble.com/">Dribble</a></p>
<figure>
    <a href="images/infinite_scroll.gif">
    <img class="" src="images/infinite_scroll.gif" height="300px">
    </a>
    
    </figure>
<br>
<p>
Forces the user to simulate AJAX (stops headless browsers).<br><em>Combine with user sessions and data limits!</em></p>
<br>
<p>
<a href="http://videolectures.net/chi08_kieras_phc/">Psychology in Human-Computer Interaction</a> by David Kieras<br>shows this frustrates the user with lack of control.</p>
<br>
<p>
<div class="reference_footnote">Image from <a href="https://visualhierarchy.co/blog/wp-content/uploads/2015/09/infinite_scroll.gif">visualhierarchy</a></div></p>
</section><section  data-background="images/infinite-hate.gif" class="vertical-slide">
<p>
<br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><font color="black"></p>
<br>
<p>
<div class="reference_footnote">Image from <a href="https://dribbble.com/shots/2152555-I-Hate-Infinite-Scroll">Per Vestman@Dribble</a></div><br></font></p>
</section><section   class="vertical-slide">
<p>
<h2><code>WhiteHat6</code>: JavaScript page links</h2></p>
<br>
<p>
Stateful browser can slowly pull the data like a real user.</p>
<br>
<p>
SHOW EXAMPLE:</p>
</section>
</section><section class="vertical-stack">
<section id="Hack7"  class="vertical-slide">
<p>
<h2><code>BlackHat7</code>: Watermarking</h2>implementation <strong>EASY</strong> : defense <strong>ROBUST</strong> : hack-level <strong>SCRIPT-KIDDIE</strong></p>
<br>
<p>
<h4>Easy mode, simple IP protection</h4></p>
<figure>
    <a href="images/watermark_examples/shutterstock1.jpg">
    <img class="" src="images/watermark_examples/shutterstock1.jpg" height="300">
    </a>
    <figcaption>Easy to remove.</figcaption>
    </figure>
<figure>
    <a href="images/watermark_examples/shutterstock2.jpg">
    <img class="" src="images/watermark_examples/shutterstock2.jpg" height="300">
    </a>
    <figcaption>Requires time to remove, not automated.</figcaption>
    </figure>
<br>
<p>
Can watermark non images too! SHOW EXAMPLE.</p>
</section>
</section><section class="vertical-stack">
<section id="Hack8"  class="vertical-slide">
<p>
<h2><code>BlackHat8</code>: Honeypots & Stenography</h2>implementation <strong>NON TRIVIAL</strong> : defense <strong>SUBTLE</strong> : hack-level <strong>COVERT-OPS</strong><br>Steganography: embed data to identify and track IP/credentials.</p>
<br>
<p>
A legal strong-arm strategy, freely give data but track its distribution.</p>
<br>
<p>
Useful to determine ToS violations!</p>
<br>
<p>
Poison the well! Leave fake data buried deep within the dataset!</p>
</section><section   class="vertical-slide">
<p>
<h3>Image stenography</h3>Hide data in the EXIF header (obvious place, easy to remove), <a href="http://www.sno.phy.queensu.ca/~phil/exiftool/">ExifTool</a></p>
<figure>
    <a href="images/honeypot_examples/panda.jpg">
    <img class="" src="images/honeypot_examples/panda.jpg" >
    </a>
    <figcaption><a href="https://flic.kr/p/9eopJm">Kevin Dooley, Flickr</a></figcaption>
    </figure>
<br>
<pre><code class=python>$ identify -verbose panda.jpg 

 Image: panda.jpg
  Format: JPEG (Joint Photographic Experts Group JFIF format)
  ...
  Properties:
    date:create: 2016-01-10T11:58:10-05:00
    exif:ApertureValue: 327680/65536
    exif:ColorSpace: 1
    exif:DateTime: 2009:08:01 08:59:44
    exif:DateTimeOriginal: 2009:07:24 04:17:22
   ...</code></pre>
</section><section   class="vertical-slide">
<p>
<h3>Image stenography</h3>Map post-filter md5sum to user data (not resistant to image changes).<br>Impossible for user to know what is being stored!</p>
<br>
<pre><code class=python>import numpy as np
from scipy.ndimage import imread
from scipy.misc import imsave

jpg = imread(&quot;panda.jpg&quot;)
idx = np.random.uniform(size=jpg.shape) &lt; 0.001
jpg[idx] += np.random.uniform(-2,2, size=idx.sum()).astype(np.uint8)
jpg[jpg&lt;0] = 0
jpg[jpg&gt;255] = 255
imsave(&quot;panda_new.jpg&quot;, jpg)
# Test on command line
# $ md5sum *.jpg
# bd1a44ba2111eb675e78935d4d5cc186  panda.jpg
# 672c6dbf03828ea50a70bc81e19bfd69  panda_new.jpg</code></pre>
<br>
<figure>
    <a href="images/honeypot_examples/panda.jpg">
    <img class="" src="images/honeypot_examples/panda.jpg" >
    </a>
    
    </figure>
<figure>
    <a href="images/honeypot_examples/panda_new.jpg">
    <img class="" src="images/honeypot_examples/panda_new.jpg" >
    </a>
    
    </figure>
</section><section   class="vertical-slide">
<p>
<h3>General stenography</h3></p>
<br>
<p>
Works for any lossy format (mp3, gif, etc...)<br>For tabular data, hide identification in NULL fields that can be easily removed.<br>Perturb date-times by seconds in data records and save the offset.</p>
<br>
<p>
<h3>Honeypots</h3></p>
<br>
<p>
If a bot or persistant downloader is idenified, feed them faulty data... ex.<br>Continually degrade image quality sent as function of DL's<br>Remove rows, or return records not found with increasing frequency.</p>
</section><section   class="vertical-slide">
<p>
<h2><code>WhiteHat9</code>: Honeypots & Stenography</h2></p>
<br>
<p>
Download data multiple times from different sources.</p>
<br>
<p>
Run <code>diff</code> commands to suss out data that changes by IP and user.</p>
<br>
<p>
Sanitize data by rejecting fields and entries that change with alternative DLs.</p>
<br>
<p>
Modify image to remove stenography (apply same trick twice!)</p>
</section>
</section><section class="vertical-stack">
<section id="Hack9"  class="vertical-slide">
<p>
<h2><code>BlackHat9</code>: Remove markup metadata</h2>implementation <strong>XXXX</strong> : defense <strong>XXXX</strong> : hack-level <strong>MASOCHIST</strong></p>
<br>
<p>
<h3>Two ways:</h3><h4>1. Break the standard UX design.</h4><h4>2. Remove proper HTML/CSS markup.</h4></p>
<br>
<p>
Organized webpage = Organized data = Easy rip</p>
</section><section   class="vertical-slide">
<p>
Eschew all user design and layer components dynamically.<br>Example: <a href="http://arngren.net/">http://arngren.net/</a></p>
<figure>
    <a href="images/badUX_arngren.png">
    <img class="" src="images/badUX_arngren.png" >
    </a>
    
    </figure>
</section><section   class="vertical-slide">
<p>
Remove markup. You can't rip what you can't see.</p>
<br>
<pre><code class=python>&lt;div class=&quot;author&quot;&gt;
    &lt;div class=&quot;firstname&quot;&gt;Preston &lt;/div&gt;
    &lt;div class=&quot;lastname&quot;&gt; Garvey  &lt;/div&gt;
&lt;div&gt;

&lt;div class=&quot;author&quot;&gt;
    &lt;div class=&quot;firstname&quot;&gt;Piper &lt;/div&gt; 
    &lt;div class=&quot;lastname&quot;&gt; Wright  &lt;/div&gt;
&lt;div&gt;</code></pre>
<br>
<pre><code class=python>&lt;!-- Remove all class and id labels, like this --&gt; 
&lt;div style=&quot;font-weight: bold;&quot;&gt;
Preston Garvey &lt;/br&gt;
Piper Wright
&lt;/div&gt;</code></pre>
</section>
</section><section class="vertical-stack">
<section id="Hack10"  class="vertical-slide">
<p>
<h2><code>BlackHat10</code>: HTML obfuscation</h2>implementation <strong>EASY</strong> : defense <strong>SANITY-REDUCING</strong> : hack-level <strong>SCRIPT-KIDDIE</strong></p>
</section>
</section><section class="vertical-stack">
<section id="Hack11"  class="vertical-slide">
<p>
<h2><code>BlackHat11</code>: Serving as PDF</h2>implementation <strong>XXXX</strong> : defense <strong>EXECELLENT</strong> : hack-level <strong>XXXX</strong></p>
<br>
<p>
<h3>Text to PDF</h3><a href="http://phantomjs.org/">PhantomJS</a>, <a href="http://wkhtmltopdf.org/">Wkhtmltopdf</a> or <a href="http://pdfkit.org/">PDFKit</a> (node.js)</p>
</section>
</section><section class="vertical-stack">
<section id="Hack12"  class="vertical-slide">
<p>
<h2><code>BlackHat12</code>: Font remapping</h2>implementation <strong>WTF</strong> : defense <strong>RIDICULOUS</strong> : hack-level <strong>MITNICK</strong></p>
</section>
</section><section class="vertical-stack">
<section   class="vertical-slide">
<p>
<h1>Thanks you!</h1></p>
<br>
<p>
Got any more Black Hat Hacks? Let us know!<h5><code>#blackhatdata</code> / <a href="https://twitter.com/metasemantic">@metasemantic</a> / <a href="https://twitter.com/rdempsey">@rdempsey</a></h5></p>
</section>
</section>
    </div></div>

    <script src="reveal.js/lib/js/head.min.js"></script>
    <script src="reveal.js/js/reveal.js"></script>

    <script>
      // Full list of configuration options available here:
      // https://github.com/hakimel/reveal.js#configuration
      Reveal.initialize({
      overview: true, height: 900, keyboard: {37: 'prev', 39: 'next'}, touch: true, hideAddressBar: true, rollingLinks: false, mouseWheel: true, controls: false, width: 1200, viewDistance: 3, rtl: false, progress: true, fragments: true, autoSlide: 0, autoSlideStoppable: true, backgroundtransition: "default", transitionSpeed: "default", slideNumber: true, center: true, embedded: true, transition: "default", maxScale: 1.2, minScale: 0.2, previewLinks: false, margin: 0.05, loop: false, history: true, 
      
      theme: Reveal.getQueryHash().theme, 
      // available themes are in reveal.js/css/theme

      // Optional libraries used to extend on reveal.js
      dependencies: [ { src: 'reveal.js/lib/js/classList.js', condition: function() { 
    return !document.body.classList; } },

{ src: 'reveal.js/plugin/markdown/showdown.js', condition: function() { 
    return !!document.querySelector( '[data-markdown]' ); } },

{ src: 'reveal.js/plugin/markdown/markdown.js', condition: function() { 
    return !!document.querySelector( '[data-markdown]' ); } },

{ src: 'reveal.js/plugin/highlight/highlight.js', async: true, callback: 
  function() { hljs.initHighlightingOnLoad(); } },

{ src: 'reveal.js/plugin/zoom-js/zoom.js', async: true, condition: 
  function() { return !!document.body.classList; } },
 ]

      });
    </script>

  </body>
</html>
